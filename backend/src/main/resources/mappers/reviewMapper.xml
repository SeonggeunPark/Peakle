<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.mvc.model.dao.ReviewDao">
	
	<!-- 암장id, 유저id 기반 리뷰 조회 -->
	<select id="selectAll" resultType="Review">
	SELECT * FROM review WHERE
	<!-- 암장 검색 조건 -->
	<if test="facilityId != 0">
		facility_id = #{facilityId}
	</if>
	<if test="facilityId != 0 and userId != 0">
		AND
	</if>
	<if test="userId != 0">
		user_id = #{userId}
	</if>
	</select>
	
	<!-- 리뷰 단일 조회 -->
	<select id="selectOne" resultType="Review">
		SELECT * FROM review WHERE id = #{id}
	</select>
	
	<!-- 리뷰 등록 -->
	<insert id="insertReview" parameterType="Review">
		INSERT INTO review (user_id, facility_id, title, writer,rating, content)
		VALUES (#{userId}, #{facilityId}, #{title}, #{writer}, #{rating}, #{content})
	</insert>
	
	<!-- 리뷰 수정 -->
	<update id="updateReview">
		UPDATE review
		SET title = #{title}, content = #{content}
		WHERE id = #{id}
	</update>
	
	<!-- 리뷰 삭제 -->
	<delete id="deleteReview" parameterType="int">
		DELETE FROM review
		WHERE id = #{id}
	</delete>
	
	<!-- 해당 암장에 대한 모든 리뷰 조회-->
	<select id="selectAllFacilReview" resultType="Review">
	SELECT * 
	FROM review 
	WHERE facility_id = #{facilityId}
	ORDER BY created DESC;
	</select>
</mapper>